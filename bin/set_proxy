#!/usr/bin/env bash

# Author: takuzoo3868
# Last Modified: 10 May 2019.

trap 'echo Error: $0:$LINENO stopped; exit 1' ERR INT
set -euo pipefail

GIT_CONFIG_FILE=$HOME/.gitconfig.local

if [[ $(uname) = "Linux" ]]; then
  MY_SSID=$(iwgetid -r)

  if test "${MY_SSID}" = "UECWireless" || test "${MY_SSID}" = "netarch2_5G"; then
    export http_proxy=http://proxy.uec.ac.jp:8080/
    export https_proxy=https://proxy.uec.ac.jp:8080/
    export ALL_PROXY=http://proxy.uec.ac.jp:8080/
    git config --file $GIT_CONFIG_FILE http.proxy $http_proxy
    git config --file $GIT_CONFIG_FILE https.proxy $https_proxy
    git config --file $GIT_CONFIG_FILE url."https://".insteadOf git://
    echo "set UEC proxy!!!"
  else
    unset http_proxy
    unset https_proxy
    unset ALL_PROXY
    git config --file $GIT_CONFIG_FILE --unset http.proxy
    git config --file $GIT_CONFIG_FILE --unset https.proxy
    git config --file $GIT_CONFIG_FILE --unset url."https://".insteadOf
    echo "unset UEC proxy!!!"
  fi

elif [[ $(uname) = "Darwin" ]]; then
  AIRPORT="/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport"

  if test "` ${AIRPORT} -I |grep [^B]SSID|awk '{print $2}'`" = "UECWireless" || test "` ${AIRPORT} -I |grep [^B]SSID|awk '{print $2}'`" = "netarch2_5G"; then
    export http_proxy=http://proxy.uec.ac.jp:8080/
    export https_proxy=https://proxy.uec.ac.jp:8080/
    export ALL_PROXY=http://proxy.uec.ac.jp:8080/
    git config --file $GIT_CONFIG_FILE http.proxy $http_proxy
    git config --file $GIT_CONFIG_FILE https.proxy $https_proxy
    git config --file $GIT_CONFIG_FILE url."https://".insteadOf git://
    echo "set UEC proxy!!!"
  else
    unset http_proxy
    unset https_proxy
    unset ALL_PROXY
    git config --file $GIT_CONFIG_FILE --unset http.proxy
    git config --file $GIT_CONFIG_FILE --unset https.proxy
    git config --file $GIT_CONFIG_FILE --unset url."https://".insteadOf
    echo "unset UEC proxy!!!"
  fi
fi 